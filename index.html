```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»™ä½ çš„ç‰¹åˆ«ç¤¼ç‰© ğŸ + ä¾¿ç­¾ + æ—¥å† + å¼¹å¹•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fce4ec 0%, #f3e5f5 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }
        
        .gift-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
            position: relative;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            z-index: 10;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        h1 {
            color: #e91e63;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #9c27b0;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .message {
            background: #f9f0ff;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border-left: 5px solid #e91e63;
            text-align: left;
            line-height: 1.8;
            font-size: 1.1em;
        }
        
        .interactive {
            margin: 30px 0;
        }
        
        button {
            background: linear-gradient(45deg, #e91e63, #9c27b0);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(233,30,99,0.3);
        }
        
        .hidden-message {
            display: none;
            background: #e8f5e9;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            animation: fadeIn 1s;
        }
        
        .decoration {
            font-size: 2em;
            margin: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        .footer {
            margin-top: 30px;
            color: #777;
            font-size: 0.9em;
        }
        
        /* åŠŸèƒ½åŒºåŸŸå®¹å™¨ */
        .features-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            max-width: 1800px;
            width: 100%;
            margin-top: 20px;
            z-index: 10;
        }
        
        .feature-box {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        
        /* ä¾¿ç­¾åŒºåŸŸæ ·å¼ */
        .note-title {
            color: #4CAF50;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .note-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex-grow: 1;
        }
        
        .note-input {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1em;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .note-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .note-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .note-btn {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            padding: 10px 25px;
            font-size: 0.9em;
        }
        
        .note-btn.clear {
            background: linear-gradient(45deg, #ff9800, #ff5722);
        }
        
        .saved-notes {
            margin-top: 20px;
            flex-grow: 1;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .note-item {
            background: #FFF9C4;
            border-left: 5px solid #FFD600;
            padding: 12px;
            border-radius: 10px;
            text-align: left;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: slideIn 0.5s ease-out;
        }
        
        .note-date {
            font-size: 0.8em;
            color: #757575;
            margin-bottom: 5px;
        }
        
        .note-content {
            word-wrap: break-word;
            margin-bottom: 5px;
        }
        
        .delete-note {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #ff5252;
            color: white;
            border: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æ—¥å†åŒºåŸŸæ ·å¼ */
        .calendar-title {
            color: #2196F3;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .calendar-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            background: #2196F3;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-month {
            font-size: 1.5em;
            font-weight: bold;
            color: #2196F3;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            color: #757575;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            flex-grow: 1;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f0f0f0;
        }
        
        .calendar-day.current {
            background: #2196F3;
            color: white;
        }
        
        .calendar-day.has-note::after {
            content: '';
            position: absolute;
            bottom: 3px;
            width: 5px;
            height: 5px;
            background: #4CAF50;
            border-radius: 50%;
        }
        
        .day-notes {
            margin-top: 20px;
            padding: 15px;
            background: #E3F2FD;
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .day-notes-title {
            color: #2196F3;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .day-note-item {
            padding: 8px;
            background: white;
            border-radius: 5px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-note-delete {
            background: #ff5252;
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* å¼¹å¹•æ§åˆ¶åŒºåŸŸæ ·å¼ */
        .danmaku-title {
            color: #FF4081;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .danmaku-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex-grow: 1;
        }
        
        .danmaku-input-container {
            display: flex;
            gap: 10px;
        }
        
        .danmaku-input {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .danmaku-input:focus {
            outline: none;
            border-color: #FF4081;
        }
        
        .danmaku-send {
            background: linear-gradient(45deg, #FF4081, #F50057);
            padding: 12px 25px;
            font-size: 0.9em;
        }
        
        .danmaku-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .danmaku-btn {
            background: linear-gradient(45deg, #FF4081, #F50057);
            padding: 8px 20px;
            font-size: 0.9em;
        }
        
        .danmaku-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .setting-label {
            font-size: 0.9em;
        }
        
        .setting-value {
            font-weight: bold;
            color: #FF4081;
        }
        
        input[type="range"] {
            width: 70%;
        }
        
        /* å¼¹å¹•æ˜¾ç¤ºåŒºåŸŸ */
        .danmaku-display {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .danmaku-item {
            position: absolute;
            white-space: nowrap;
            pointer-events: none;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            animation: danmakuMove linear forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes danmakuMove {
            from {
                transform: translateX(100vw);
            }
            to {
                transform: translateX(-100%);
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .features-container {
                flex-direction: column;
                max-width: 900px;
            }
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            .gift-box, .feature-box { padding: 20px; }
            .message { font-size: 1em; }
            .note-title, .calendar-title, .danmaku-title { font-size: 1.5em; }
            .calendar-days { gap: 3px; }
            .danmaku-input-container { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="gift-box">
        <div class="header">
            <h1>ğŸ ç»™ä½ çš„ç‰¹åˆ«ç¤¼ç‰© ğŸ</h1>
            <div class="subtitle">ç”¨å¿ƒåˆ¶ä½œçš„æ•°å­—ç¤¼ç‰©ï¼Œåªä¸ºç‰¹åˆ«çš„ä½ </div>
        </div>
        
        <div class="decoration">âœ¨ ğŸ’– âœ¨</div>
        
        <div class="message">
            <p>äº²çˆ±çš„æœ‹å‹ï¼š</p>
            <p>æœ‰äº›ç¤¼ç‰©æ˜¯çœ‹å¾—è§çš„ï¼Œæœ‰äº›ç¤¼ç‰©æ˜¯æ„Ÿå—å¾—åˆ°çš„ã€‚è¿™ä¸ªå°å°ç½‘é¡µä»£è¡¨ç€æˆ‘çš„ä¸€ä»½å¿ƒæ„â€”â€”æ„Ÿè°¢ä½ çš„å­˜åœ¨ï¼Œè®©è¿™ä¸ªä¸–ç•Œå˜å¾—æ›´åŠ ç¾å¥½ã€‚</p>
            <p>æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰ï¼Œæ„¿ä½ çš„æ¯ä¸ªæ¢¦æƒ³éƒ½èƒ½ç»½æ”¾ï¼Œæ„¿å¿«ä¹å¸¸ä¼´ä½ å·¦å³ï¼</p>
            <p style="text-align: right; margin-top: 15px;">â€”â€” å…³å¿ƒä½ çš„äºº ğŸ’</p>
        </div>
        
        <div class="interactive">
            <button onclick="showMessage()">ç‚¹å‡»æ¥æ”¶ç¥ç¦</button>
            <button onclick="changeBackground()">æ¢ä¸ªå¿ƒæƒ…</button>
            
            <div id="secretMessage" class="hidden-message">
                <h3>ğŸ‰ æƒŠå–œï¼</h3>
                <p>ä½ å‘ç°äº†éšè—çš„ç¥ç¦ï¼</p>
                <p>æ„¿ä½ ï¼š<br>
                å‰ç¨‹ä¼¼é”¦ï¼Œä¸‡äº‹é¡ºé‚<br>
                ç¬‘å£å¸¸å¼€ï¼Œå¥½è¿å¸¸æ¥<br>
                å¿ƒä¸­æ‰€å¿µï¼Œçš†èƒ½å¦‚æ„¿ï¼</p>
                <div style="font-size: 2em; margin-top: 10px;">ğŸŒˆ âœ¨ ğŸŒŸ</div>
            </div>
        </div>
        
        <div class="decoration">ğŸˆ ğŸ‚ ğŸˆ</div>
        
        <div class="footer">
            <p>è¿™ä»½ç¤¼ç‰©ç”±HTML/CSS/JSåˆ¶æˆ | åˆ·æ–°é¡µé¢ä¼šæœ‰ä¸åŒæ•ˆæœå“¦</p>
            <p>Â© <span id="currentYear"></span> ç‰¹åˆ«ä¸ºä½ åˆ¶ä½œ</p>
        </div>
    </div>

    <!-- åŠŸèƒ½åŒºåŸŸ -->
    <div class="features-container">
        <!-- ä¾¿ç­¾åŒºåŸŸ -->
        <div class="feature-box">
            <div class="note-title">
                <span>ğŸ“ ä½ çš„ä¸“å±ä¾¿ç­¾</span>
            </div>
            
            <div class="note-container">
                <textarea id="noteInput" class="note-input" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•ã€å¾…åŠäº‹é¡¹ã€çµæ„Ÿæˆ–ä»»ä½•æƒ³è®°å½•çš„å†…å®¹..."></textarea>
                
                <div class="note-buttons">
                    <button class="note-btn" onclick="saveNote()">ä¿å­˜ä¾¿ç­¾</button>
                    <button class="note-btn clear" onclick="clearAllNotes()">æ¸…ç©ºæ‰€æœ‰ä¾¿ç­¾</button>
                    <button class="note-btn" onclick="addSampleNote()">æ·»åŠ ç¤ºä¾‹ä¾¿ç­¾</button>
                </div>
                
                <div class="saved-notes">
                    <h3 style="color: #4CAF50; margin-bottom: 10px; font-size: 1.2em;">ğŸ“‹ å·²ä¿å­˜çš„ä¾¿ç­¾</h3>
                    <div id="notesList" class="notes-list">
                        <!-- ä¾¿ç­¾ä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ—¥å†åŒºåŸŸ -->
        <div class="feature-box">
            <div class="calendar-title">
                <span>ğŸ“… æ—¥å†ä¸æ—¥ç¨‹</span>
            </div>
            
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="changeMonth(-1)">â€¹</button>
                    <div class="calendar-month" id="currentMonth">2023å¹´12æœˆ</div>
                    <button class="calendar-nav" onclick="changeMonth(1)">â€º</button>
                </div>
                
                <div class="calendar-weekdays">
                    <div>æ—¥</div>
                    <div>ä¸€</div>
                    <div>äºŒ</div>
                    <div>ä¸‰</div>
                    <div>å››</div>
                    <div>äº”</div>
                    <div>å…­</div>
                </div>
                
                <div class="calendar-days" id="calendarDays">
                    <!-- æ—¥å†å¤©æ•°ä¼šåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="day-notes" id="dayNotesContainer">
                    <div class="day-notes-title" id="selectedDayTitle">æœªé€‰æ‹©æ—¥æœŸ</div>
                    <div id="dayNotesList">
                        <!-- é€‰ä¸­æ—¥æœŸçš„ä¾¿ç­¾ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å¼¹å¹•æ§åˆ¶åŒºåŸŸ -->
        <div class="feature-box">
            <div class="danmaku-title">
                <span>ğŸ¯ åŠ¨æ€å¼¹å¹•</span>
            </div>
            
            <div class="danmaku-container">
                <div class="danmaku-input-container">
                    <input type="text" id="danmakuInput" class="danmaku-input" placeholder="è¾“å…¥å¼¹å¹•å†…å®¹ï¼Œç„¶åå‘é€...">
                    <button class="danmaku-send" onclick="sendDanmaku()">å‘é€å¼¹å¹•</button>
                </div>
                
                <div class="danmaku-controls">
                    <button class="danmaku-btn" onclick="toggleDanmaku()">æš‚åœ/ç»§ç»­å¼¹å¹•</button>
                    <button class="danmaku-btn" onclick="clearDanmaku()">æ¸…é™¤æ‰€æœ‰å¼¹å¹•</button>
                    <button class="danmaku-btn" onclick="addSampleDanmaku()">æ·»åŠ ç¤ºä¾‹å¼¹å¹•</button>
                </div>
                
                <div class="danmaku-settings">
                    <div class="setting-row">
                        <span class="setting-label">å¼¹å¹•é€Ÿåº¦ï¼š</span>
                        <span class="setting-value" id="speedValue">5</span>
                    </div>
                    <input type="range" id="speedSlider" min="1" max="10" value="5" oninput="updateDanmakuSpeed(this.value)">
                    
                    <div class="setting-row">
                        <span class="setting-label">å¼¹å¹•å¯†åº¦ï¼š</span>
                        <span class="setting-value" id="densityValue">3</span>
                    </div>
                    <input type="range" id="densitySlider" min="1" max="5" value="3" oninput="updateDanmakuDensity(this.value)">
                    
                    <div class="setting-row">
                        <span class="setting-label">å­—ä½“å¤§å°ï¼š</span>
                        <span class="setting-value" id="fontSizeValue">20</span>
                    </div>
                    <input type="range" id="fontSizeSlider" min="16" max="30" value="20" oninput="updateDanmakuFontSize(this.value)">
                </div>
            </div>
        </div>
    </div>

    <!-- å¼¹å¹•æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="danmaku-display" id="danmakuDisplay"></div>

    <script>
        // å…¨å±€å˜é‡
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDay = null;
        let danmakuActive = true;
        let danmakuSpeed = 5;
        let danmakuDensity = 3;
        let danmakuFontSize = 20;
        let danmakuInterval = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–ç¤¼ç‰©ç›’åŠ¨ç”»
            document.querySelector('.gift-box').style.opacity = '0';
            document.querySelector('.gift-box').style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                document.querySelector('.gift-box').style.transition = 'opacity 1s, transform 1s';
                document.querySelector('.gift-box').style.opacity = '1';
                document.querySelector('.gift-box').style.transform = 'translateY(0)';
            }, 300);
            
            // æ·»åŠ éšæœºè£…é¥°
            const decorations = ['ğŸŒ¸', 'ğŸ€', 'ğŸ¨', 'ğŸ¯', 'ğŸ§¸', 'ğŸª', 'ğŸ®', 'ğŸµ'];
            const decorElements = document.querySelectorAll('.decoration');
            decorElements.forEach(el => {
                el.innerHTML = decorations[Math.floor(Math.random() * decorations.length)] + 
                              ' ğŸ’– ' + 
                              decorations[Math.floor(Math.random() * decorations.length)];
            });
            
            // è®¾ç½®å½“å‰å¹´ä»½
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // åˆå§‹åŒ–åŠŸèƒ½
            loadNotes();
            generateCalendar();
            startDanmaku();
            
            // æ·»åŠ ä¸€äº›åˆå§‹å¼¹å¹•
            setTimeout(() => {
                const initialDanmaku = [
                    "ğŸ‰ ç¥ä½ å¤©å¤©å¼€å¿ƒï¼",
                    "âœ¨ è¿™ä¸ªç½‘é¡µå¥½æœ‰è¶£ï¼",
                    "ğŸ’– æ„¿ä½ æ¢¦æƒ³æˆçœŸï¼",
                    "ğŸ è¿™æ˜¯ä¸€ä»½ç‰¹åˆ«çš„ç¤¼ç‰©",
                    "ğŸŒŸ å……æ»¡æƒŠå–œçš„ç½‘é¡µ"
                ];
                
                initialDanmaku.forEach((text, index) => {
                    setTimeout(() => {
                        createDanmaku(text);
                    }, index * 1000);
                });
            }, 2000);
        };
        
        // ==================== ç¤¼ç‰©é¡µé¢åŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºéšè—ä¿¡æ¯
        function showMessage() {
            const message = document.getElementById('secretMessage');
            message.style.display = 'block';
            
            // æ·»åŠ ä¸€äº›ç‰¹æ•ˆ
            document.querySelector('.gift-box').style.transform = 'scale(1.02)';
            setTimeout(() => {
                document.querySelector('.gift-box').style.transform = 'scale(1)';
            }, 300);
        }
        
        // æ›´æ”¹èƒŒæ™¯é¢œè‰²
        function changeBackground() {
            const colors = [
                'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
                'linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%)',
                'linear-gradient(135deg, #fdcbf1 0%, #e6dee9 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)'
            ];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            document.body.style.background = randomColor;
            
            // å¼¹å¹•é¢œè‰²ä¼šæ ¹æ®èƒŒæ™¯è‡ªåŠ¨è°ƒæ•´
            updateAllDanmakuColors();
        }
        
        // ==================== ä¾¿ç­¾åŠŸèƒ½ ====================
        
        // ä¿å­˜ä¾¿ç­¾åˆ°localStorage
        function saveNote() {
            const noteInput = document.getElementById('noteInput');
            const noteText = noteInput.value.trim();
            
            if (noteText === '') {
                showNotification('è¯·è¾“å…¥ä¾¿ç­¾å†…å®¹ï¼', 'warning');
                return;
            }
            
            // è·å–ç°æœ‰ä¾¿ç­¾
            let notes = JSON.parse(localStorage.getItem('giftNotes')) || [];
            
            // åˆ›å»ºæ–°ä¾¿ç­¾å¯¹è±¡
            const newNote = {
                id: Date.now(),
                text: noteText,
                date: new Date().toLocaleString('zh-CN'),
                color: getRandomNoteColor()
            };
            
            // æ·»åŠ åˆ°ä¾¿ç­¾åˆ—è¡¨
            notes.push(newNote);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('giftNotes', JSON.stringify(notes));
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            noteInput.value = '';
            
            // é‡æ–°åŠ è½½ä¾¿ç­¾åˆ—è¡¨
            loadNotes();
            
            // æ›´æ–°æ—¥å†æ˜¾ç¤ºï¼ˆå¦‚æœå½“å‰é€‰ä¸­äº†æ—¥æœŸï¼‰
            if (selectedDay) {
                showDayNotes(selectedDay);
            }
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showNotification('ä¾¿ç­¾å·²ä¿å­˜ï¼', 'success');
        }
        
        // åŠ è½½ä¾¿ç­¾
        function loadNotes() {
            const notesList = document.getElementById('notesList');
            const notes = JSON.parse(localStorage.getItem('giftNotes')) || [];
            
            // æ¸…ç©ºç°æœ‰åˆ—è¡¨
            notesList.innerHTML = '';
            
            if (notes.length === 0) {
                notesList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px;">è¿˜æ²¡æœ‰ä¾¿ç­¾ï¼Œå¿«æ¥å†™ç¬¬ä¸€æ¡å§ï¼</div>';
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            notes.sort((a, b) => b.id - a.id);
            
            // æ·»åŠ æ¯ä¸ªä¾¿ç­¾åˆ°åˆ—è¡¨
            notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'note-item';
                noteElement.style.borderLeftColor = note.color;
                
                noteElement.innerHTML = `
                    <button class="delete-note" onclick="deleteNote(${note.id})">Ã—</button>
                    <div class="note-date">${note.date}</div>
                    <div class="note-content">${escapeHtml(note.text).replace(/\n/g, '<br>')}</div>
                `;
                
                notesList.appendChild(noteElement);
            });
        }
        
        // åˆ é™¤ä¾¿ç­¾
        function deleteNote(noteId) {
            let notes = JSON.parse(localStorage.getItem('giftNotes')) || [];
            
            // è¿‡æ»¤æ‰è¦åˆ é™¤çš„ä¾¿ç­¾
            notes = notes.filter(note => note.id !== noteId);
            
            // ä¿å­˜æ›´æ–°åçš„ä¾¿ç­¾åˆ—è¡¨
            localStorage.setItem('giftNotes', JSON.stringify(notes));
            
            // é‡æ–°åŠ è½½ä¾¿ç­¾åˆ—è¡¨
            loadNotes();
            
            // æ›´æ–°æ—¥å†æ˜¾ç¤ºï¼ˆå¦‚æœå½“å‰é€‰ä¸­äº†æ—¥æœŸï¼‰
            if (selectedDay) {
                showDayNotes(selectedDay);
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('ä¾¿ç­¾å·²åˆ é™¤', 'info');
        }
        
        // æ¸…ç©ºæ‰€æœ‰ä¾¿ç­¾
        function clearAllNotes() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¾¿ç­¾å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€ï¼')) {
                localStorage.removeItem('giftNotes');
                loadNotes();
                
                // æ›´æ–°æ—¥å†æ˜¾ç¤º
                if (selectedDay) {
                    showDayNotes(selectedDay);
                }
                
                showNotification('æ‰€æœ‰ä¾¿ç­¾å·²æ¸…ç©º', 'info');
            }
        }
        
        // æ·»åŠ ç¤ºä¾‹ä¾¿ç­¾
        function addSampleNote() {
            const sampleNotes = [
                "ä»Šå¤©è¦å®Œæˆçš„é‡è¦äº‹é¡¹...",
                "çªç„¶æƒ³åˆ°çš„çµæ„Ÿï¼šä¸‹æ¬¡å¯ä»¥å°è¯•...",
                "å€¼å¾—æ„Ÿæ©çš„ä¸‰ä»¶äº‹ï¼š1. 2. 3.",
                "è´­ç‰©æ¸…å•ï¼š\n- ç‰›å¥¶\n- é¸¡è›‹\n- æ°´æœ",
                "æœ¬å‘¨ç›®æ ‡ï¼š\n1. é˜…è¯»ä¸€æœ¬ä¹¦\n2. é”»ç‚¼ä¸‰æ¬¡\n3. å­¦ä¹ æ–°æŠ€èƒ½",
                "ç»™æœ‹å‹çš„ç”Ÿæ—¥ç¥ç¦ï¼šç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼Œå¤©å¤©å¼€å¿ƒï¼"
            ];
            
            const randomNote = sampleNotes[Math.floor(Math.random() * sampleNotes.length)];
            document.getElementById('noteInput').value = randomNote;
            showNotification('ç¤ºä¾‹ä¾¿ç­¾å·²æ·»åŠ ï¼Œå¯ä»¥ä¿®æ”¹åä¿å­˜', 'info');
        }
        
        // è·å–éšæœºä¾¿ç­¾é¢œè‰²
        function getRandomNoteColor() {
            const colors = ['#FFD600', '#4CAF50', '#2196F3', '#9C27B0', '#FF9800', '#009688'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // ==================== æ—¥å†åŠŸèƒ½ ====================
        
        // ç”Ÿæˆæ—¥å†
        function generateCalendar() {
            const calendarDays = document.getElementById('calendarDays');
            const currentMonthElement = document.getElementById('currentMonth');
            
            // æ¸…ç©ºæ—¥å†
            calendarDays.innerHTML = '';
            
            // è®¾ç½®å½“å‰æœˆä»½æ˜¾ç¤º
            const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
            currentMonthElement.textContent = `${currentYear}å¹´${monthNames[currentMonth]}`;
            
            // è·å–å½“å‰æœˆä»½çš„ç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const firstDayIndex = firstDay.getDay();
            
            // æ·»åŠ ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤©
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = firstDayIndex; i > 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = prevMonthLastDay - i + 1;
                dayElement.style.color = '#ccc';
                calendarDays.appendChild(dayElement);
            }
            
            // æ·»åŠ å½“å‰æœˆçš„æ‰€æœ‰å¤©æ•°
            const today = new Date();
            const notes = JSON.parse(localStorage.getItem('giftNotes')) || [];
            
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = i;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                if (currentYear === today.getFullYear() && 
                    currentMonth === today.getMonth() && 
                    i === today.getDate()) {
                    dayElement.classList.add('current');
                }
                
                // æ£€æŸ¥è¿™ä¸€å¤©æ˜¯å¦æœ‰ä¾¿ç­¾
                const dateStr = `${currentYear}-${currentMonth + 1}-${i}`;
                const hasNote = notes.some(note => {
                    const noteDate = new Date(note.id);
                    return noteDate.getFullYear() === currentYear && 
                           noteDate.getMonth() === currentMonth && 
                           noteDate.getDate() === i;
                });
                
                if (hasNote) {
                    dayElement.classList.add('has-note');
                }
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                dayElement.onclick = () => selectDay(i);
                
                calendarDays.appendChild(dayElement);
            }
            
            // æ·»åŠ ä¸‹ä¸ªæœˆçš„å‰å‡ å¤©ä»¥å¡«æ»¡ç½‘æ ¼
            const totalCells = 42; // 6è¡Œ x 7åˆ—
            const nextDays = totalCells - (firstDayIndex + daysInMonth);
            for (let i = 1; i <= nextDays; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = i;
                dayElement.style.color = '#ccc';
                calendarDays.appendChild(dayElement);
            }
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­æ—¥æœŸï¼Œé€‰ä¸­ä»Šå¤©ï¼ˆå¦‚æœåœ¨æœ¬æœˆï¼‰
            if (!selectedDay && currentYear === today.getFullYear() && currentMonth === today.getMonth()) {
                selectDay(today.getDate());
            }
        }
        
        // æ”¹å˜æœˆä»½
        function changeMonth(direction) {
            currentMonth += direction;
            
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            selectedDay = null;
            generateCalendar();
        }
        
        // é€‰æ‹©æ—¥æœŸ
        function selectDay(day) {
            selectedDay = day;
            showDayNotes(day);
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            const dayElements = document.querySelectorAll('.calendar-day');
            dayElements.forEach(el => el.classList.remove('current-selected'));
            
            // æ‰¾åˆ°é€‰ä¸­çš„æ—¥æœŸå…ƒç´ 
            const selectedElement = Array.from(dayElements).find(el => {
                return el.textContent == day && !el.style.color; // æ’é™¤ç°è‰²æ—¥æœŸ
            });
            
            if (selectedElement) {
                selectedElement.style.background = '#4CAF50';
                selectedElement.style.color = 'white';
            }
        }
        
        // æ˜¾ç¤ºé€‰ä¸­æ—¥æœŸçš„ä¾¿ç­¾
        function showDayNotes(day) {
            const dayNotesList = document.getElementById('dayNotesList');
            const selectedDayTitle = document.getElementById('selectedDayTitle');
            
            // è®¾ç½®æ ‡é¢˜
            selectedDayTitle.textContent = `${currentYear}å¹´${currentMonth + 1}æœˆ${day}æ—¥çš„ä¾¿ç­¾`;
            
            // è·å–æ‰€æœ‰ä¾¿ç­¾
            const notes = JSON.parse(localStorage.getItem('giftNotes')) || [];
            
            // è¿‡æ»¤å‡ºé€‰ä¸­æ—¥æœŸçš„ä¾¿ç­¾
            const dayNotes = notes.filter(note => {
                const noteDate = new Date(note.id);
                return noteDate.getFullYear() === currentYear && 
                       noteDate.getMonth() === currentMonth && 
                       noteDate.getDate() === day;
            });
            
            // æ¸…ç©ºåˆ—è¡¨
            dayNotesList.innerHTML = '';
            
            if (dayNotes.length === 0) {
                dayNotesList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px;">è¿™ä¸€å¤©æ²¡æœ‰ä¾¿ç­¾</div>';
                return;
            }
            
            // æ·»åŠ ä¾¿ç­¾åˆ°åˆ—è¡¨
            dayNotes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'day-note-item';
                
                noteElement.innerHTML = `
                    <div>${escapeHtml(note.text).substring(0, 30)}${note.text.length > 30 ? '...' : ''}</div>
                    <button class="day-note-delete" onclick="deleteNote(${note.id}); showDayNotes(${day});">Ã—</button>
                `;
                
                dayNotesList.appendChild(noteElement);
            });
        }
        
        // ==================== å¼¹å¹•åŠŸèƒ½ ====================
        
        // å¼€å§‹å¼¹å¹•
        function startDanmaku() {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (danmakuInterval) clearInterval(danmakuInterval);
            
            // æ ¹æ®å¯†åº¦è®¾ç½®å®šæ—¶å™¨
            const intervalTime = 1000 / danmakuDensity;
            danmakuInterval = setInterval(() => {
                if (danmakuActive) {
                    // éšæœºæ˜¾ç¤ºä¸€æ¡å¼¹å¹•
                    const danmakuList = JSON.parse(localStorage.getItem('giftDanmaku')) || [];
                    if (danmakuList.length > 0) {
                        const randomIndex = Math.floor(Math.random() * danmakuList.length);
                        createDanmaku(danmakuList[randomIndex].text);
                    }
                }
            }, intervalTime);
        }
        
        // åˆ›å»ºå¼¹å¹•
        function createDanmaku(text) {
            if (!text || text.trim() === '') return;
            
            const danmakuDisplay = document.getElementById('danmakuDisplay');
            const danmakuItem = document.createElement('div');
            danmakuItem.className = 'danmaku-item';
            danmakuItem.textContent = text;
            
            // è®¾ç½®éšæœºæ ·å¼
            const top = Math.random() * 90; // 0-90% çš„éšæœºä½ç½®
            const color = getRandomColor();
            const speed = 10 + (10 - danmakuSpeed) * 5; // é€Ÿåº¦å€¼è¶Šå¤§ï¼Œå®é™…é€Ÿåº¦è¶Šæ…¢
            
            danmakuItem.style.top = `${top}%`;
            danmakuItem.style.color = color;
            danmakuItem.style.fontSize = `${danmakuFontSize}px`;
            danmakuItem.style.animationDuration = `${speed}s`;
            
            // æ ¹æ®èƒŒæ™¯äº®åº¦è°ƒæ•´æ–‡å­—é˜´å½±ï¼Œç¡®ä¿å¯è¯»æ€§
            adjustDanmakuShadow(danmakuItem, color);
            
            // æ·»åŠ åˆ°æ˜¾ç¤ºåŒºåŸŸ
            danmakuDisplay.appendChild(danmakuItem);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (danmakuItem.parentNode) {
                    danmakuItem.parentNode.removeChild(danmakuItem);
                }
            }, speed * 1000);
        }
        
        // å‘é€å¼¹å¹•
        function sendDanmaku() {
            const danmakuInput = document.getElementById('danmakuInput');
            const text = danmakuInput.value.trim();
            
            if (text === '') {
                showNotification('è¯·è¾“å…¥å¼¹å¹•å†…å®¹ï¼', 'warning');
                return;
            }
            
            // è·å–ç°æœ‰å¼¹å¹•
            let danmakuList = JSON.parse(localStorage.getItem('giftDanmaku')) || [];
            
            // åˆ›å»ºæ–°å¼¹å¹•å¯¹è±¡
            const newDanmaku = {
                id: Date.now(),
                text: text,
                date: new Date().toLocaleString('zh-CN')
            };
            
            // æ·»åŠ åˆ°å¼¹å¹•åˆ—è¡¨
            danmakuList.push(newDanmaku);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('giftDanmaku', JSON.stringify(danmakuList));
            
            // ç«‹å³æ˜¾ç¤ºå¼¹å¹•
            createDanmaku(text);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            danmakuInput.value = '';
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showNotification('å¼¹å¹•å·²å‘é€ï¼', 'success');
        }
        
        // åˆ‡æ¢å¼¹å¹•çŠ¶æ€
        function toggleDanmaku() {
            danmakuActive = !danmakuActive;
            showNotification(danmakuActive ? 'å¼¹å¹•å·²ç»§ç»­' : 'å¼¹å¹•å·²æš‚åœ', 'info');
        }
        
        // æ¸…é™¤æ‰€æœ‰å¼¹å¹•
        function clearDanmaku() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å¼¹å¹•å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€ï¼')) {
                localStorage.removeItem('giftDanmaku');
                document.getElementById('danmakuDisplay').innerHTML = '';
                showNotification('æ‰€æœ‰å¼¹å¹•å·²æ¸…é™¤', 'info');
            }
        }
        
        // æ·»åŠ ç¤ºä¾‹å¼¹å¹•
        function addSampleDanmaku() {
            const sampleDanmaku = [
                "ğŸ‰ ç¥ä½ å¤©å¤©å¼€å¿ƒï¼",
                "âœ¨ è¿™ä¸ªç½‘é¡µå¥½æœ‰è¶£ï¼",
                "ğŸ’– æ„¿ä½ æ¢¦æƒ³æˆçœŸï¼",
                "ğŸ è¿™æ˜¯ä¸€ä»½ç‰¹åˆ«çš„ç¤¼ç‰©",
                "ğŸŒŸ å……æ»¡æƒŠå–œçš„ç½‘é¡µ",
                "ğŸ˜Š ç¥ä½ æ¯å¤©éƒ½æœ‰å¥½å¿ƒæƒ…",
                "ğŸŒˆ ç”Ÿæ´»å°±åƒå½©è™¹ä¸€æ ·å¤šå½©",
                "ğŸˆ è®©å¿«ä¹åƒæ°”çƒä¸€æ ·é£èµ·æ¥",
                "ğŸ€ å¥½è¿å¸¸ä¼´ä½ å·¦å³",
                "â­ ä½ æ˜¯æœ€é—ªäº®çš„æ˜Ÿ"
            ];
            
            const randomDanmaku = sampleDanmaku[Math.floor(Math.random() * sampleDanmaku.length)];
            document.getElementById('danmakuInput').value = randomDanmaku;
            showNotification('ç¤ºä¾‹å¼¹å¹•å·²æ·»åŠ ï¼Œå¯ä»¥ä¿®æ”¹åå‘é€', 'info');
        }
        
        // æ›´æ–°å¼¹å¹•é€Ÿåº¦
        function updateDanmakuSpeed(value) {
            danmakuSpeed = parseInt(value);
            document.getElementById('speedValue').textContent = value;
            
            // é‡æ–°å¼€å§‹å¼¹å¹•ä»¥åº”ç”¨æ–°é€Ÿåº¦
            startDanmaku();
        }
        
        // æ›´æ–°å¼¹å¹•å¯†åº¦
        function updateDanmakuDensity(value) {
            danmakuDensity = parseInt(value);
            document.getElementById('densityValue').textContent = value;
            
            // é‡æ–°å¼€å§‹å¼¹å¹•ä»¥åº”ç”¨æ–°å¯†åº¦
            startDanmaku();
        }
        
        // æ›´æ–°å¼¹å¹•å­—ä½“å¤§å°
        function updateDanmakuFontSize(value) {
            danmakuFontSize = parseInt(value);
            document.getElementById('fontSizeValue').textContent = value;
        }
        
        // æ ¹æ®èƒŒæ™¯è°ƒæ•´æ‰€æœ‰å¼¹å¹•é¢œè‰²
        function updateAllDanmakuColors() {
            const danmakuItems = document.querySelectorAll('.danmaku-item');
            danmakuItems.forEach(item => {
                const color = item.style.color;
                adjustDanmakuShadow(item, color);
            });
        }
        
        // æ ¹æ®èƒŒæ™¯äº®åº¦è°ƒæ•´å¼¹å¹•é˜´å½±
        function adjustDanmakuShadow(element, color) {
            // è®¡ç®—é¢œè‰²çš„äº®åº¦
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            
            // æ ¹æ®äº®åº¦è®¾ç½®æ–‡å­—é˜´å½±
            if (brightness > 128) {
                // äº®è‰²æ–‡å­—ï¼Œä½¿ç”¨æ·±è‰²é˜´å½±
                element.style.textShadow = '1px 1px 3px rgba(0, 0, 0, 0.7)';
            } else {
                // æš—è‰²æ–‡å­—ï¼Œä½¿ç”¨æµ…è‰²é˜´å½±
                element.style.textShadow = '1px 1px 3px rgba(255, 255, 255, 0.7)';
            }
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = [
                '#FF4081', '#F50057', '#C51162', '#FF1744', '#D50000', '#E91E63',
                '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4',
                '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107',
                '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // ==================== é€šç”¨åŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            // ç§»é™¤ä¹‹å‰çš„é€šçŸ¥
            const oldNotification = document.querySelector('.notification');
            if (oldNotification) {
                oldNotification.remove();
            }
            
            // åˆ›å»ºæ–°é€šçŸ¥
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
            let bgColor, textColor;
            switch(type) {
                case 'success':
                    bgColor = '#4CAF50';
                    textColor = 'white';
                    break;
                case 'warning':
                    bgColor = '#FF9800';
                    textColor = 'white';
                    break;
                case 'info':
                    bgColor = '#2196F3';
                    textColor = 'white';
                    break;
                default:
                    bgColor = '#333';
                    textColor = 'white';
            }
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: ${textColor};
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideInRight 0.5s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease-out';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
            
            // æ·»åŠ CSSåŠ¨ç”»
            if (!document.querySelector('#notificationStyle')) {
                const style = document.createElement('style');
                style.id = 'notificationStyle';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // HTMLè½¬ä¹‰ï¼Œé˜²æ­¢XSSæ”»å‡»
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
```

